# Configuración de rotación de logs para BotphIA

/Users/ja/saby/trading_api/logs/*.log {
    # Rotar diariamente
    daily
    
    # Mantener 7 días de logs
    rotate 7
    
    # Comprimir logs antiguos
    compress
    delaycompress
    
    # No rotar si está vacío
    notifempty
    
    # Crear nuevo archivo con permisos específicos
    create 0644 ja staff
    
    # Tamaño máximo antes de rotar (50MB)
    maxsize 50M
    
    # Script post-rotación para notificar al sistema
    postrotate
        # Enviar señal para reabrir logs
        if [ -f /Users/ja/saby/trading_api/production.pid ]; then
            kill -USR1 $(cat /Users/ja/saby/trading_api/production.pid | grep TRADING_PID | cut -d= -f2) 2>/dev/null || true
        fi
    endscript
}

# Configuración específica para logs de error
/Users/ja/saby/trading_api/logs/error.log {
    daily
    rotate 14  # Mantener 2 semanas de errores
    compress
    notifempty
    maxsize 20M
    create 0644 ja staff
    
    # Enviar alerta si hay muchos errores
    postrotate
        ERROR_COUNT=$(grep -c "ERROR" /Users/ja/saby/trading_api/logs/error.log.1 2>/dev/null || echo "0")
        if [ $ERROR_COUNT -gt 100 ]; then
            echo "⚠️ ALERTA: $ERROR_COUNT errores detectados en el último período" >> /Users/ja/saby/trading_api/logs/alerts.log
        fi
    endscript
}

# Logs del sistema de trading
/Users/ja/saby/trading_api/logs/trading_system.log {
    daily
    rotate 30  # Mantener 30 días de trading
    compress
    notifempty
    maxsize 100M
    create 0644 ja staff
    copytruncate  # Copiar y truncar para no interrumpir escritura
}

# Logs de señales
/Users/ja/saby/trading_api/logs/signals_*.log {
    weekly
    rotate 12  # Mantener 3 meses
    compress
    notifempty
    maxsize 50M
    create 0644 ja staff
}